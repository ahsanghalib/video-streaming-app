(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{275:function(e,t){},283:function(e,t){},418:function(e,t,r){},419:function(e,t,r){"use strict";r.r(t);var n,a,s=r(0),c=r(20),o=r.n(c),i=r(116),u=r(50),l=r(103),d=(r(233),r(494)),p=r(22),b=r(76),f=r(77);!function(e){e.error="error",e.session_id="session_id",e.router_rtp_capabilities="router_rtp_capabilities",e.create_transport="create_transport",e.connect_transport="connect_transport",e.produce="produce",e.close_webrtc="close_webrtc",e.start_stream="start_stream",e.stop_stream="stop_stream",e.streaming_sessions="streaming_sessions",e.get_streaming_sessions="get_streaming_sessions"}(n||(n={})),function(e){e.ADMIN="ADMIN",e.USER="USER"}(a||(a={}));var m,j,h=Object(b.a)(Object(f.combine)({status:"closed"},(function(e){return{setStatus:function(t){return e({status:t})}}}))),O="token",g="expiresIn",v=Object(b.a)(Object(f.combine)(function(){try{return{accessToken:localStorage.getItem(O)||"",expiresIn:localStorage.getItem(g)||"",sessionId:""}}catch(e){return{accessToken:"",expiresIn:"",sessionId:""}}}(),(function(e){return{setTokens:function(t){try{localStorage.setItem(O,t.accessToken),localStorage.setItem(g,t.expiresIn)}catch(r){}e(t)},setSessionId:function(t){return e({sessionId:t})},clearTokens:function(){try{localStorage.removeItem(O),localStorage.removeItem(g),w.getState().clearUser()}catch(t){}e({accessToken:"",expiresIn:"",sessionId:""})}}}))),x={created_at:"",email:"",first_name:"",id:"",is_active:!1,last_name:"",updated_at:"",user_type:a.USER},w=Object(b.a)(Object(f.combine)({user:x},(function(e){return{setUser:function(t){return e({user:t})},clearUser:function(){return e({user:x})}}}))),S=Object(b.a)(Object(f.combine)({mediaStream:null,sendTransport:null,producers:[],device:null,facingMode:"user",fileName:null},(function(e){return{nullify:function(){return e({sendTransport:null,mediaStream:null,producers:[],device:null,facingMode:"user",fileName:null})},set:e}}))),k=Object(b.a)(Object(f.combine)({status:"closed"},(function(e){return{setStatus:function(t){return e({status:t})}}}))),_=Object(b.a)(Object(f.combine)({streamUsers:[]},(function(e){return{setStreamUsers:function(t){return e({streamUsers:t})}}}))),y=r(473),E=r(12),T=r.n(E),C=r(26),I=r(200),N=function(e,t,r){return Object(l.b)(e,{type:t,position:"bottom-right",autoClose:2e3,hideProgressBar:!r,closeOnClick:!0,draggable:!1})},R="".concat(window.location.host),q="".concat("https:"===window.location.protocol?"https":"http","://").concat(R,"/api"),B="".concat("https:"===window.location.protocol?"wss":"ws","://").concat(R,"/socket"),P=r(135),U=new Map,L={audio:!0,video:!0},M=function(){var e=Object(C.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){e.next=6;break}return e.next=3,navigator.mediaDevices.getUserMedia(L);case 3:return e.abrupt("return",e.sent);case 6:throw N("Browser not supported.","error"),new Error("Browser not supported");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(C.a)(T.a.mark((function e(t){var r,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.routerRtpCapabilities,e.prev=1,console.log(Object(P.detectDevice)()),a=new P.Device,e.next=6,a.load({routerRtpCapabilities:r});case 6:if(S.getState().set({device:a}),a.loaded){e.next=9;break}throw new Error("Peer or device is not initialized");case 9:G({op:n.create_transport,d:{sessionId:v.getState().sessionId,userId:w.getState().user.id}}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("handleRouterRtpCapabilities() failed to init device [error:%o]",e.t0),N("Error in WebRTC....","error");case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=Object(C.a)(T.a.mark((function e(t){var r,n,a,s,c;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n=t.dtlsParameters,a=t.iceCandidates,s=t.iceParameters,e.prev=1,e.next=4,S.getState().device.createSendTransport({id:r,dtlsParameters:n,iceCandidates:a,iceParameters:s});case 4:c=e.sent,S.getState().set({sendTransport:c}),F(),z(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("handleCreateTransportRequest() failed to create transport [error:%o]",e.t0),N("Error in WebRTC....","error");case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(C.a)(T.a.mark((function e(t){var r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleTransportConnectRequest()"),e.prev=1,r=U.get("connect_transport")){e.next=5;break}throw new Error("transport-connect action was not found");case 5:return e.next=7,r(t);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.error("handleTransportConnectRequest() failed [error:%o]",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=Object(C.a)(T.a.mark((function e(t){var r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleProduceRequest()"),e.prev=1,r=U.get("produce")){e.next=5;break}throw new Error("produce action was not found");case 5:return e.next=7,r(t);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.error("handleProduceRequest() failed [error:%o]",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=S.getState().sendTransport;e.on("connect",function(){var e=Object(C.a)(T.a.mark((function e(t,r,a){var s,c;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.dtlsParameters,console.log("handleTransportConnectEvent()");try{c=function(){var e=Object(C.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("connect_transport action"),r(),U.delete("connect_transport");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U.set("connect_transport",c),G({op:n.connect_transport,d:{sessionId:v.getState().sessionId,transportId:S.getState().sendTransport.id,dtlsParameters:s}})}catch(o){console.error("handleTransportConnectEvent() failed [error:%o]",o),a(o)}case 3:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()),e.on("produce",function(){var e=Object(C.a)(T.a.mark((function e(t,r,a){var s,c,o;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.kind,c=t.rtpParameters,console.log("handleTransportProduceEvent()");try{o=function(){var e=Object(C.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleTransportProduceEvent callback [data:%o]",t),r({id:t.id}),U.delete("produce");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U.set("produce",o),G({op:n.produce,d:{sessionId:v.getState().sessionId,transportId:S.getState().sendTransport.id,kind:s,rtpParameters:c}})}catch(i){console.error("handleTransportProduceEvent() failed [error:%o]",i),a(i)}case 3:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()),e.on("connectionstatechange",(function(e){switch(console.log("send transport connection state change [state:%s]",e),k.getState().setStatus(e),e){case"connected":N("WebRTC is connected","info");break;case"connecting":N("WebRTC is connecting...","warning");break;case"disconnected":N("WebRTC is disconnected","error");break;case"failed":N("WebRTC is connection failed","error")}}))},J=function(e){var t,r;console.log("closing webrtc..."),null===(t=S.getState().mediaStream)||void 0===t||t.getTracks().forEach((function(e){return e.stop()})),null===(r=S.getState().sendTransport)||void 0===r||r.close(),S.getState().producers.forEach((function(e){return e.close()})),S.getState().nullify()},z=function(){var e=Object(C.a)(T.a.mark((function e(){var t,r,n,a,s,c,o,i;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M();case 3:if(t=e.sent,S.getState().set({mediaStream:t}),r=S.getState().device,n=t.getVideoTracks()[0],a=t.getAudioTracks()[0],s=S.getState().sendTransport,c=S.getState().producers,!n){e.next=15;break}return e.next=13,s.produce({track:n,codec:r.rtpCapabilities.codecs.find((function(e){return"video/vp8"===e.mimeType.toLowerCase()}))});case 13:o=e.sent,c.push(o);case 15:if(!a){e.next=20;break}return e.next=18,s.produce({track:a});case 18:i=e.sent,c.push(i);case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),N(e.t0.toString(),"error"),console.log(e.t0);case 26:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(){return e.apply(this,arguments)}}();window.addEventListener("online",(function(){m&&m.readyState===m.CLOSED&&(N("Reconnecting...","info"),console.log("online triggered, calling ws.reconnect()"),m.reconnect())}));var H=function(){var e;null===(e=m)||void 0===e||e.close(),m=null},G=function(e){var t;m&&m.readyState===m.OPEN?null===(t=m)||void 0===t||t.send(JSON.stringify(e)):(console.log("ws not ready"),j=e,console.log(j))},K=function(){var e=Object(C.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next=e.t0===n.session_id?3:e.t0===n.router_rtp_capabilities?5:e.t0===n.create_transport?7:e.t0===n.connect_transport?9:e.t0===n.produce?11:e.t0===n.close_webrtc?13:e.t0===n.start_stream?15:e.t0===n.streaming_sessions?17:e.t0===n.error?19:21;break;case 3:return v.getState().setSessionId(t.d.session_id),e.abrupt("break",23);case 5:return W(t.d),e.abrupt("break",23);case 7:return V(t.d),e.abrupt("break",23);case 9:return D(t.d),e.abrupt("break",23);case 11:return A(t.d),e.abrupt("break",23);case 13:return J(t.d),e.abrupt("break",23);case 15:return Q(t.d),e.abrupt("break",23);case 17:return X(t.d),e.abrupt("break",23);case 19:return N(t.d.message,"error"),e.abrupt("break",23);case 21:return console.log(t),e.abrupt("break",23);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(e){var t=e.fileName;S.getState().set({fileName:t})},X=function(e){var t,r={};for(t in e)t!==v.getState().sessionId&&(r[t]=e[t]);var n=Object.entries(r).map((function(e){return{userId:e[1].userId,fileName:e[1].fileName,userName:e[1].userName}}));_.getState().setStreamUsers(n)},Y=r(5),Z=function(){var e=w((function(e){return e.user})),t=Object(p.g)(),r=Object(p.h)();return Object(Y.jsxs)("div",{className:"flex flex-row flex-wrap items-center justify-between gap-4",children:[Object(Y.jsxs)("div",{className:"flex flex-row flex-wrap items-center gap-4",children:[Object(Y.jsxs)("div",{className:"text-l font-semibold",children:[e.first_name," ",e.last_name," (",e.email,")"]}),"/stream"===r.pathname?Object(Y.jsx)(y.a,{variant:"contained",color:"primary",onClick:function(){t.push("/"),G({op:n.close_webrtc,d:{sessionId:v.getState().sessionId,userId:w.getState().user.id,fileName:S.getState().fileName}})},children:"Back"}):"/"===r.pathname?Object(Y.jsx)(Y.Fragment,{children:Object(Y.jsx)(y.a,{variant:"contained",color:"primary",onClick:function(){return t.push("/stream")},children:"Go Live!"})}):Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsx)(y.a,{variant:"contained",color:"primary",onClick:function(){return t.push("/")},children:"Home"}),Object(Y.jsx)(y.a,{variant:"contained",color:"primary",onClick:function(){return t.push("/stream")},children:"Go Live!"})]})]}),Object(Y.jsx)(y.a,{variant:"contained",color:"secondary",onClick:function(){v.getState().clearTokens(),H(),t.push("/")},children:"Logout"})]})},$=function(e){var t=e.children;return v((function(e){return!!e.accessToken}))?Object(Y.jsxs)("div",{className:"mx-6 my-14 bg-white rounded p-6",children:[Object(Y.jsx)(Z,{}),Object(Y.jsx)("div",{className:"mt-6",children:t})]}):Object(Y.jsx)("div",{children:t})},ee=function(){var e=_((function(e){return e.streamUsers}));return Object(s.useEffect)((function(){G({op:n.get_streaming_sessions,d:{}})}),[]),Object(Y.jsx)("div",{children:e.length>0?Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsxs)("b",{children:["Streaming Users [Total users: ",e.length,"]"]}),Object(Y.jsx)("br",{}),Object(Y.jsx)("br",{}),e.map((function(e,t){return Object(Y.jsx)("div",{className:"flex gap-4",children:Object(Y.jsxs)("div",{children:[t+1,": ",Object(Y.jsx)("b",{children:e.userName})," is streaming."," ",Object(Y.jsx)(u.b,{to:"/live/".concat(e.fileName),className:"underline",children:"To Watch Click Here"})]})},e.fileName)}))]}):Object(Y.jsx)("b",{children:"No User is streaming..."})})},te=r(21),re=r(493),ne=r(215),ae=(r(169),function(e){var t=e.options,r=e.fileName,n=Object(re.a)(),a=n.width,c=n.height,o=Object(s.useRef)(),i=Object(s.useRef)(),u=Object(s.useMemo)((function(){return{controls:!0,preload:"true",responsive:!0,width:a-120,height:c-250,controlBar:{volumePanel:{inline:!1}}}}),[c,a]);return Object(s.useEffect)((function(){return i.current=Object(ne.a)(o.current,Object(te.a)(Object(te.a)({},u),t)).ready((function(){console.log("onPlayerReady")})),function(){i.current&&i.current.dispose()}}),[u,t]),Object(Y.jsx)("div",{className:"flex items-center",children:Object(Y.jsx)("video",{ref:o,className:"video-js vjs-default-skin",children:Object(Y.jsx)("source",{src:"http://localhost/live/".concat(r,"/index.m3u8"),type:"application/x-mpegURL"})})})}),se=function(){var e=Object(p.i)().id,t=Object(p.g)();return Object(s.useEffect)((function(){e||t.push("/")}),[t,e]),Object(Y.jsxs)("div",{children:[Object(Y.jsx)("b",{children:"Live"}),Object(Y.jsx)("br",{}),Object(Y.jsx)("div",{className:"flex w-full justify-center items-start",children:Object(Y.jsx)(ae,{fileName:e})})]})},ce=r(32),oe=r(496),ie=r(8),ue=r(478),le=r(425),de=r(422),pe=r(423),be=r(427),fe=r(420),me=r(216),je=r(497),he=r(498),Oe=r(477),ge=r(495),ve=r(479),xe=r(480),we=r(481),Se=r(482),ke=r(491),_e=r(483),ye=r(485),Ee=r(486),Te=r(489),Ce=r(484),Ie=r(487),Ne=r(488),Re=r(499),qe=Object(ie.a)({})(y.a),Be=(Object(ie.a)({})(Oe.a),Object(ie.a)({root:{width:"100%"}})(ue.a)),Pe=(Object(ie.a)({})(le.a),Object(ie.a)({root:{width:"100%"}})(de.a),Object(ie.a)({})(pe.a),Object(ie.a)({})(be.a),Object(ie.a)({})(fe.a),Object(ie.a)({})(me.a),Object(ie.a)({})(je.a),Object(ie.a)({})(ge.a),Object(ie.a)({})(ve.a),Object(ie.a)({})(xe.a),Object(ie.a)({})(we.a),Object(ie.a)({})(Se.a),Object(ie.a)({})(he.a),Object(ie.a)({})(ke.a),Object(ie.a)({})(_e.a),Object(ie.a)({})(Ce.a),Object(ie.a)({})(ye.a),Object(ie.a)({})(Ee.a),Object(ie.a)({})(Ie.a),Object(ie.a)({})(Ne.a),Object(ie.a)({})(Te.a),Object(ie.a)({})(Re.a),r(46)),Ue=r(39);function Le(e){var t=e.initErrors,r=e.initValues,n=e.values,a=e.setValues,c=e.validateSchema,o=Object(s.useState)(t),i=Object(ce.a)(o,2),u=i[0],l=i[1];return{handleChange:function(e){var r=e.target.name,s="checkbox"===e.target.type?e.target.checked:e.target.value;a(Object(te.a)(Object(te.a)({},n),{},Object(Pe.a)({},r,s))),l(t)},handleBlur:function(e){var t=e.target.name,r=e.target.value;Ue.b(c,t,"","").validate(r).catch((function(e){l(Object(te.a)(Object(te.a)({},u),{},Object(Pe.a)({},t,e.message)))}))},handleReset:function(){return a(r)},formValidation:function(){var e=Object(C.a)(T.a.mark((function e(){var r;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ue.b(c,"","","").validate(n,{abortEarly:!1});case 3:return l(Object(te.a)({},t)),e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(0),r=e.t0.inner.reduce((function(e,t){return e[t.path]?Object(te.a)({},e):Object(te.a)(Object(te.a)({},e),{},Object(Pe.a)({},t.path,t.message))}),{}),l(Object(te.a)(Object(te.a)({},u),r)),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),formErrors:u,selectChange:function(e,t){a(Object(te.a)(Object(te.a)({},n),{},Object(Pe.a)({},t,e)))},numberChange:function(e,t){a(Object(te.a)(Object(te.a)({},n),{},Object(Pe.a)({},t,isNaN(e)?0:e)))},cascaderSelect:function(e,t){var r=t.reduce((function(t,r,n){return Object(te.a)(Object(te.a)({},t),{},Object(Pe.a)({},r,e[n]))}),{});a(Object(te.a)(Object(te.a)({},n),r))},changeMaskInput:function(e,t){a(Object(te.a)(Object(te.a)({},n),{},Object(Pe.a)({},t,e)))},changeSwitch:function(e,t){a(Object(te.a)(Object(te.a)({},n),{},Object(Pe.a)({},t,e)))}}}var Me=r(214),We=r.n(Me);function Ve(){var e={baseURL:q,headers:{"Content-Type":"application/json"}},t=We.a.create(e);return t.interceptors.request.use((function(e){var t=localStorage.getItem("token");return e.headers.Authorization=t,e})),t.defaults.headers.common.Authorization=v.getState().accessToken,t}var De={email:"",password:""},Ae={email:"",password:""},Fe={confirm_password:"",first_name:"",last_name:"",password:"",email:""},Je={confirm_password:"",first_name:"",last_name:"",password:"",email:""},ze=Ue.a({email:Ue.c().required("Required").email("Wrong email address"),password:Ue.c().required("Required")}),He=Ue.a({first_name:Ue.c().required("Required"),last_name:Ue.c().required("Required"),email:Ue.c().required("Required").email("Wrong email address"),password:Ue.c().required("Required").min(6,"Min 6 charaters"),confirm_password:Ue.c().required("Required").min(6,"Min 6 charaters")}),Ge=function(){var e=v().setTokens,t=w().setUser,r=Object(p.g)(),n=Object(oe.a)((function(e){return Ve().post("/login",e)}),{onSuccess:function(n){e({accessToken:n.data.accessToken,expiresIn:n.data.expiresIn}),t(n.data.user),r.replace("/")}}),a=Object(s.useState)(De),c=Object(ce.a)(a,2),o=c[0],i=c[1],l=Le({initErrors:Ae,initValues:De,setValues:i,validateSchema:ze,values:o}),d=function(){var e=Object(C.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.formValidation();case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:n.mutate(o);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(Y.jsx)("div",{className:"flex items-center min-h-screen",children:Object(Y.jsxs)("div",{className:"max-w-md m-auto bg-white p-6 shadow-md rounded",children:[Object(Y.jsx)("div",{className:"text-xl font-bold",children:"Login"}),Object(Y.jsxs)("form",{children:[Object(Y.jsx)(Be,{id:"email",label:"Email",name:"email",variant:"standard",margin:"dense",value:o.email,onChange:l.handleChange,onBlur:l.handleBlur,helperText:""!==l.formErrors.email?l.formErrors.email:" ",error:""!==l.formErrors.email}),Object(Y.jsx)(Be,{id:"password",name:"password",label:"Password",variant:"standard",margin:"dense",type:"password",value:o.password,onChange:l.handleChange,onBlur:l.handleBlur,helperText:""!==l.formErrors.password?l.formErrors.password:" ",error:""!==l.formErrors.password}),Object(Y.jsx)("br",{}),Object(Y.jsx)("br",{}),Object(Y.jsxs)("div",{className:"flex flex-row flex-wrap items-center justify-between gap-4",children:[Object(Y.jsx)("div",{children:Object(Y.jsx)(qe,{variant:"contained",color:"primary",onClick:d,disabled:n.isLoading,children:"Login"})}),Object(Y.jsxs)("div",{children:["or ",Object(Y.jsx)(u.b,{to:"/register",children:"Register a new Account"})]})]})]})]})})},Ke=function(){var e=v().setTokens,t=w().setUser,r=Object(p.g)(),n=Object(oe.a)((function(e){return Ve().post("/register",e)}),{onSuccess:function(n){e({accessToken:n.data.accessToken,expiresIn:n.data.expiresIn}),t(n.data.user),r.replace("/")}}),a=Object(s.useState)(Fe),c=Object(ce.a)(a,2),o=c[0],i=c[1],l=Le({initErrors:Je,initValues:Fe,setValues:i,validateSchema:He,values:o}),d=function(){var e=Object(C.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.formValidation();case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:n.mutate(o);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(Y.jsx)("div",{className:"flex items-center min-h-screen",children:Object(Y.jsxs)("div",{className:"max-w-md m-auto bg-white p-6 shadow-md rounded",children:[Object(Y.jsx)("div",{className:"text-xl font-bold",children:"Register"}),Object(Y.jsxs)("form",{children:[Object(Y.jsx)(Be,{id:"first_name",label:"First name",name:"first_name",variant:"standard",margin:"dense",value:o.first_name,onChange:l.handleChange,onBlur:l.handleBlur,helperText:""!==l.formErrors.first_name?l.formErrors.first_name:" ",error:""!==l.formErrors.first_name}),Object(Y.jsx)(Be,{id:"last_name",label:"First name",name:"last_name",variant:"standard",margin:"dense",value:o.last_name,onChange:l.handleChange,onBlur:l.handleBlur,helperText:""!==l.formErrors.last_name?l.formErrors.last_name:" ",error:""!==l.formErrors.last_name}),Object(Y.jsx)(Be,{id:"email",label:"Email",name:"email",variant:"standard",margin:"dense",value:o.email,onChange:l.handleChange,onBlur:l.handleBlur,helperText:""!==l.formErrors.email?l.formErrors.email:" ",error:""!==l.formErrors.email}),Object(Y.jsx)(Be,{id:"password",name:"password",label:"Password",variant:"standard",margin:"dense",type:"password",value:o.password,onChange:l.handleChange,onBlur:l.handleBlur,helperText:""!==l.formErrors.password?l.formErrors.password:" ",error:""!==l.formErrors.password}),Object(Y.jsx)(Be,{id:"confirm_password",name:"confirm_password",label:"Confirm password",variant:"standard",margin:"dense",type:"password",value:o.confirm_password,onChange:l.handleChange,onBlur:l.handleBlur,helperText:""!==l.formErrors.confirm_password?l.formErrors.confirm_password:" ",error:""!==l.formErrors.confirm_password}),Object(Y.jsx)("br",{}),Object(Y.jsx)("br",{}),Object(Y.jsxs)("div",{className:"flex flex-row flex-wrap items-center justify-between gap-4",children:[Object(Y.jsx)("div",{children:Object(Y.jsx)(qe,{variant:"contained",color:"primary",onClick:d,disabled:n.isLoading,children:"Register"})}),Object(Y.jsxs)("div",{children:["or ",Object(Y.jsx)(u.b,{to:"/",children:"Already registered."})]})]})]})]})})},Qe=function(){var e=Object(re.a)().height,t=v((function(e){return e.sessionId})),r=Object(s.useRef)(null),a=S((function(e){return e.mediaStream})),c=Object(s.useState)(!1),o=Object(ce.a)(c,2),i=o[0],u=o[1],l=Object(s.useState)(!1),d=Object(ce.a)(l,2),p=d[0],b=d[1];return Object(s.useLayoutEffect)((function(){G({op:n.router_rtp_capabilities,d:{sessionId:t}})}),[t]),Object(s.useEffect)((function(){a&&r.current&&(r.current.srcObject=a,u(!0))}),[a]),Object(Y.jsxs)("div",{children:[Object(Y.jsxs)("div",{className:"flex items-center justify-center flex-row flex-wrap",children:[Object(Y.jsx)(y.a,{disabled:!i,onClick:function(){G({op:n.start_stream,d:{sessionId:v.getState().sessionId,userId:w.getState().user.id,userName:"".concat(w.getState().user.first_name," ").concat(w.getState().user.last_name)}}),u(!1),b(!0)},children:"Start Streaming"}),Object(Y.jsx)(y.a,{disabled:!p,onClick:function(){G({op:n.stop_stream,d:{sessionId:v.getState().sessionId,userId:w.getState().user.id,fileName:S.getState().fileName}}),u(!0),b(!1)},children:"Stop Streaming"})]}),Object(Y.jsx)("div",{className:"flex w-full justify-center items-start",children:Object(Y.jsx)("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,controls:!0,style:{maxWidth:"1000px",maxHeight:"700px",width:"100%",height:"".concat(e-250,"px")}})})]})},Xe=function(){var e=v((function(e){return!!e.accessToken})),t=Object(d.a)("user-info",(function(){return Ve().get("/userInfo")}),{onSuccess:function(e){return w.getState().setUser(e.data.user)},enabled:e}).isError;Object(s.useLayoutEffect)((function(){var t;e&&(console.log("createWebSocket"),t||!m?(console.log("new ws instance coming"),h.getState().setStatus("connecting"),(m=new I.a(B,void 0,{connectionTimeout:15e3})).addEventListener("close",(function(e){h.getState().setStatus("closed"),N("Connection closed.","error"),console.log("ws closed.")})),m.addEventListener("open",(function(e){h.getState().setStatus("open"),N("Connected","success");var t=setInterval((function(){m&&m.readyState!==m.CLOSED?m.send("ping"):clearInterval(t)}),3e3)})),m.addEventListener("message",(function(e){if("ping"!==e.data){var t;j&&(null===(t=m)||void 0===t||t.send(JSON.stringify(j)),j="");var r=JSON.parse(e.data);K(r)}}))):console.log("ws already connected"))}),[e]),Object(s.useEffect)((function(){t&&(v.getState().clearTokens(),H())}),[t]);var r=Object(Y.jsxs)(p.d,{children:[Object(Y.jsx)(p.b,{path:"/",exact:!0,component:Ge}),Object(Y.jsx)(p.b,{path:"/register",exact:!0,component:Ke}),Object(Y.jsx)(p.a,{to:"/"})]});return e&&(r=Object(Y.jsxs)(p.d,{children:[Object(Y.jsx)(p.b,{path:"/",exact:!0,component:ee}),Object(Y.jsx)(p.b,{path:"/stream",exact:!0,component:Qe}),Object(Y.jsx)(p.b,{path:"/live/:id",exact:!0,component:se})]})),Object(Y.jsx)($,{children:r})},Ye=(r(418),new(r(492).a)({defaultOptions:{mutations:{onError:function(e){e.response&&e.response.data.message&&N(e.response.data.message,"error")}},queries:{retry:!1,staleTime:3e5,onError:function(e){e.response&&e.response.data.message&&N(e.response.data.message,"error")}}}})),Ze=Object(Y.jsxs)(i.a,{client:Ye,children:[Object(Y.jsx)(u.a,{children:Object(Y.jsx)(Xe,{})}),Object(Y.jsx)(l.a,{})]});o.a.render(Ze,document.getElementById("root"))}},[[419,1,2]]]);
//# sourceMappingURL=main.d5375b5b.chunk.js.map