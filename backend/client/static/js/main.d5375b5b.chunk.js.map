{"version":3,"sources":["utils/types.ts","stores/index.ts","utils/createWebSocket.ts","components/ShowToast.tsx","utils/apiQueries.ts","utils/webrtc.ts","components/Headers.tsx","components/Layout.tsx","containers/Home.tsx","components/VideoPlayer.tsx","containers/Live.tsx","components/StyledComponents.tsx","hooks/useForm.tsx","utils/axiosClient.ts","utils/formInits.ts","utils/validations.ts","containers/Login.tsx","containers/Register.tsx","containers/Stream.tsx","App.tsx","utils/queryClient.ts","index.tsx"],"names":["Oper","UserTypesEnum","ws","lastMsg","useSocketStatus","create","combine","status","set","setStatus","accessTokenKey","expiresInKey","useTokenStore","accessToken","localStorage","getItem","expiresIn","sessionId","getDefaultValues","setTokens","x","setItem","setSessionId","clearTokens","removeItem","useUserInfoStore","getState","clearUser","user","created_at","email","first_name","id","is_active","last_name","updated_at","user_type","USER","setUser","useMediaStore","mediaStream","sendTransport","producers","device","facingMode","fileName","nullify","useMediaSoupConnectionState","useStreamingUsers","streamUsers","setStreamUsers","ShowToast","m","t","progress","toast","type","position","autoClose","hideProgressBar","closeOnClick","draggable","baseUrl","window","location","host","apiBaseUrl","protocol","wsBaseUrl","queue","Map","defaultConstraints","audio","video","getUserMedia","a","navigator","mediaDevices","Error","handleRouterRtpCapabilitiesRequest","msg","routerRtpCapabilities","console","log","detectDevice","Device","load","loaded","wsend","op","create_transport","d","userId","error","handleCreateTransportRequest","dtlsParameters","iceCandidates","iceParameters","createSendTransport","handleSendTransportListeners","getMediaStream","handleConnectTransportRequest","action","get","handleProduceRequest","on","callback","errback","json","delete","connect_transport","transportId","kind","rtpParameters","produce","connectionState","handleCloseWebRTCConnection","getTracks","forEach","stop","close","p","videoTrack","getVideoTracks","audioTrack","getAudioTracks","track","codec","rtpCapabilities","codecs","find","mimeType","toLowerCase","videoProducer","push","audioProducer","toString","addEventListener","readyState","CLOSED","reconnect","closeWebSocket","OPEN","send","JSON","stringify","handleSocketMessages","session_id","router_rtp_capabilities","close_webrtc","start_stream","streaming_sessions","handleStartStreaming","handleStreamingSession","message","key","result","Object","entries","map","v","userName","Headers","s","history","useHistory","useLocation","className","pathname","Button","variant","color","onClick","Layout","children","Home","useEffect","get_streaming_sessions","length","i","to","VideoPlayer","options","useWindowSize","width","height","videoNode","useRef","player","initialOptions","useMemo","controls","preload","responsive","controlBar","volumePanel","inline","current","videojs","ready","dispose","ref","src","Live","useParams","CusButton","withStyles","CusTextField","Paper","root","TextField","Select","FormControl","FormHelperText","InputLabel","Input","Menu","MenuItem","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","Chip","Checkbox","FormControlLabel","TableContainer","Table","TableBody","TableHead","TableRow","TableCell","TableSortLabel","useForm","initErrors","initValues","values","setValues","validateSchema","useState","formErrors","setFormErrors","handleChange","event","name","target","value","checked","handleBlur","yup","validate","catch","err","handleReset","formValidation","abortEarly","errors","inner","reduce","acc","path","selectChange","fieldName","numberChange","isNaN","cascaderSelect","fieldValues","cur","index","changeMaskInput","changeSwitch","axiosClient","defaultOptions","baseURL","headers","instance","axios","interceptors","request","use","config","token","Authorization","defaults","common","LoginFormInitValues","password","LoginFormInitErrors","RegisterFormInitValues","confirm_password","RegisterFormInitErrors","LoginFormValidation","required","RegisterFormValidation","min","Login","mutation","useMutation","input","post","onSuccess","res","data","replace","formValues","setFormValues","form","handleSubmit","mutate","label","margin","onChange","onBlur","helperText","disabled","isLoading","Register","Stream","start","setStart","setStop","useLayoutEffect","srcObject","stop_stream","autoPlay","playsInline","muted","style","maxWidth","maxHeight","App","hasToken","isError","useQuery","enabled","force","ReconnectingWebSocket","undefined","connectionTimeout","setInterval","clearInterval","e","parse","routes","exact","component","queryClient","QueryClient","mutations","onError","response","queries","retry","staleTime","app","QueryClientProvider","client","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.d5375b5b.chunk.js","sourcesContent":["import * as yup from \"yup\";\nimport { LoginFormValidation, RegisterFormValidation } from \"./validations\";\n\nexport type WsParam = {\n  op: Oper;\n  d: any;\n};\n\nexport enum Oper {\n  error = \"error\",\n  session_id = \"session_id\",\n  router_rtp_capabilities = \"router_rtp_capabilities\",\n  create_transport = \"create_transport\",\n  connect_transport = \"connect_transport\",\n  produce = \"produce\",\n  close_webrtc = \"close_webrtc\",\n  start_stream = \"start_stream\",\n  stop_stream = \"stop_stream\",\n  streaming_sessions = \"streaming_sessions\",\n  get_streaming_sessions = \"get_streaming_sessions\",\n}\n\nexport enum UserTypesEnum {\n  ADMIN = \"ADMIN\",\n  USER = \"USER\",\n}\n\nexport type RegisterFormInput = yup.InferType<typeof RegisterFormValidation>;\nexport type LoginFormInput = yup.InferType<typeof LoginFormValidation>;\n\nexport type UserInfoType = {\n  id: string;\n  first_name: string;\n  last_name: string;\n  email: string;\n  is_active: boolean;\n  updated_at: string;\n  created_at: string;\n  user_type: UserTypesEnum;\n};\n","import { Device, Producer, Transport } from \"mediasoup-client/lib/types\";\nimport create from \"zustand\";\nimport { combine } from \"zustand/middleware\";\nimport { UserInfoType, UserTypesEnum } from \"../utils/types\";\n\n/**\n * userSocketStatus\n */\ntype State = \"connecting\" | \"open\" | \"closed\" | \"auth_good\" | \"auth_bad\";\n\nexport const useSocketStatus = create(\n  combine(\n    {\n      status: \"closed\" as State,\n    },\n    (set) => ({\n      setStatus: (status: State) => set({ status }),\n    })\n  )\n);\n\n/**\n * userTokenStore\n */\nconst accessTokenKey = \"token\";\nconst expiresInKey = \"expiresIn\";\n\nconst getDefaultValues = () => {\n  try {\n    return {\n      accessToken: localStorage.getItem(accessTokenKey) || \"\",\n      expiresIn: localStorage.getItem(expiresInKey) || \"\",\n      sessionId: \"\",\n    };\n  } catch {\n    return {\n      accessToken: \"\",\n      expiresIn: \"\",\n      sessionId: \"\",\n    };\n  }\n};\n\nexport const useTokenStore = create(\n  combine(getDefaultValues(), (set) => ({\n    setTokens: (x: { accessToken: string; expiresIn: string }) => {\n      try {\n        localStorage.setItem(accessTokenKey, x.accessToken);\n        localStorage.setItem(expiresInKey, x.expiresIn);\n      } catch {}\n      set(x);\n    },\n    setSessionId: (sessionId: string) => set({ sessionId: sessionId }),\n    clearTokens: () => {\n      try {\n        localStorage.removeItem(accessTokenKey);\n        localStorage.removeItem(expiresInKey);\n        useUserInfoStore.getState().clearUser();\n      } catch {}\n      set({ accessToken: \"\", expiresIn: \"\", sessionId: \"\" });\n    },\n  }))\n);\n\n/**\n * userUserInfoStore\n */\nconst user: UserInfoType = {\n  created_at: \"\",\n  email: \"\",\n  first_name: \"\",\n  id: \"\",\n  is_active: false,\n  last_name: \"\",\n  updated_at: \"\",\n  user_type: UserTypesEnum.USER,\n};\n\nexport const useUserInfoStore = create(\n  combine(\n    {\n      user,\n    },\n    (set) => ({\n      setUser: (user: UserInfoType) => set({ user }),\n      clearUser: () => set({ user }),\n    })\n  )\n);\n\n/**\n * Media Store\n */\n// const getDevice = () => {\n//   try {\n//     let handlerName = detectDevice();\n//     if (!handlerName) {\n//       console.warn(\n//         \"mediasoup does not recognize this device, so ben has defaulted it to Chrome74\"\n//       );\n//       handlerName = \"Chrome74\";\n//     }\n//     return new Device({ handlerName });\n//   } catch {\n//     return null;\n//   }\n// };\n\ntype facingModeType = \"user\" | \"environment\";\n\nexport const useMediaStore = create(\n  combine(\n    {\n      mediaStream: null as MediaStream | null,\n      sendTransport: null as Transport | null,\n      producers: [] as Producer[],\n      device: null as Device | null,\n      facingMode: \"user\" as facingModeType,\n      fileName: null as string | null,\n    },\n    (set) => ({\n      nullify: () =>\n        set({\n          sendTransport: null,\n          mediaStream: null,\n          producers: [],\n          device: null,\n          facingMode: \"user\",\n          fileName: null,\n        }),\n      set,\n    })\n  )\n);\n\n/**\n * mediasoup connection state\n */\nexport type ConnectionState =\n  | \"new\"\n  | \"connecting\"\n  | \"connected\"\n  | \"failed\"\n  | \"disconnected\"\n  | \"closed\";\n\nexport const useMediaSoupConnectionState = create(\n  combine(\n    {\n      status: \"closed\" as ConnectionState,\n    },\n    (set) => ({\n      setStatus: (status: ConnectionState) => set({ status }),\n    })\n  )\n);\n\n/**\n * streaming users\n */\n\ntype StreamingUsers = Array<{\n  userId: string;\n  userName: string;\n  fileName: string;\n}>;\n\nexport const useStreamingUsers = create(\n  combine(\n    {\n      streamUsers: [] as StreamingUsers,\n    },\n    (set) => ({\n      setStreamUsers: (streamUsers: StreamingUsers) => set({ streamUsers }),\n    })\n  )\n);\n","import ReconnectingWebSocket from \"reconnecting-websocket\";\nimport { ShowToast } from \"../components/ShowToast\";\nimport {\n  useMediaStore,\n  useSocketStatus,\n  useStreamingUsers,\n  useTokenStore,\n} from \"../stores\";\nimport { wsBaseUrl } from \"./apiQueries\";\nimport { Oper, WsParam } from \"./types\";\nimport {\n  handleCloseWebRTCConnection,\n  handleConnectTransportRequest,\n  handleCreateTransportRequest,\n  handleProduceRequest,\n  handleRouterRtpCapabilitiesRequest,\n} from \"./webrtc\";\n\nlet ws: ReconnectingWebSocket | null;\nlet lastMsg: any;\n\nwindow.addEventListener(\"online\", () => {\n  if (ws && ws.readyState === ws.CLOSED) {\n    ShowToast(\"Reconnecting...\", \"info\");\n    console.log(\"online triggered, calling ws.reconnect()\");\n    ws.reconnect();\n  }\n});\n\nexport const closeWebSocket = () => {\n  ws?.close();\n  ws = null;\n};\n\nexport const createWebSocket = (force?: boolean) => {\n  console.log(\"createWebSocket\");\n\n  if (!force && ws) {\n    console.log(\"ws already connected\");\n    return;\n  } else {\n    console.log(\"new ws instance coming\");\n  }\n\n  useSocketStatus.getState().setStatus(\"connecting\");\n\n  ws = new ReconnectingWebSocket(wsBaseUrl, undefined, {\n    connectionTimeout: 15000,\n  });\n\n  ws.addEventListener(\"close\", (event) => {\n    useSocketStatus.getState().setStatus(\"closed\");\n    ShowToast(\"Connection closed.\", \"error\");\n    console.log(\"ws closed.\");\n  });\n\n  ws.addEventListener(\"open\", (event) => {\n    useSocketStatus.getState().setStatus(\"open\");\n    ShowToast(\"Connected\", \"success\");\n    const id = setInterval(() => {\n      if (ws && ws.readyState !== ws.CLOSED) {\n        ws.send(\"ping\");\n      } else {\n        clearInterval(id);\n      }\n    }, 3000);\n  });\n\n  ws.addEventListener(\"message\", (e) => {\n    if (e.data === \"ping\") {\n      return;\n    }\n\n    if (lastMsg) {\n      ws?.send(JSON.stringify(lastMsg));\n      lastMsg = \"\";\n    }\n\n    const json: WsParam = JSON.parse(e.data);\n    handleSocketMessages(json);\n  });\n};\n\nexport const wsend = (d: WsParam) => {\n  if (!ws || ws.readyState !== ws.OPEN) {\n    console.log(\"ws not ready\");\n    lastMsg = d;\n    console.log(lastMsg);\n  } else {\n    ws?.send(JSON.stringify(d));\n  }\n};\n\nconst handleSocketMessages = async (json: WsParam) => {\n  switch (json.op) {\n    case Oper.session_id:\n      useTokenStore.getState().setSessionId(json.d.session_id);\n      break;\n    case Oper.router_rtp_capabilities:\n      handleRouterRtpCapabilitiesRequest(json.d);\n      break;\n    case Oper.create_transport:\n      handleCreateTransportRequest(json.d);\n      break;\n    case Oper.connect_transport:\n      handleConnectTransportRequest(json.d);\n      break;\n    case Oper.produce:\n      handleProduceRequest(json.d);\n      break;\n    case Oper.close_webrtc:\n      handleCloseWebRTCConnection(json.d);\n      break;\n    case Oper.start_stream:\n      handleStartStreaming(json.d);\n      break;\n    case Oper.streaming_sessions:\n      handleStreamingSession(json.d);\n      break;\n    // case Oper.get_streaming_sessions:\n    //   handleStreamingSession(json.d);\n    //   break;\n    case Oper.error:\n      ShowToast(json.d.message, \"error\");\n      break;\n    default:\n      console.log(json);\n      break;\n  }\n};\n\nconst handleStartStreaming = (msg: any) => {\n  const { fileName } = msg;\n  useMediaStore.getState().set({ fileName });\n};\n\nconst handleStreamingSession = (msg: any) => {\n  let result: any = {};\n  let key;\n\n  for (key in msg) {\n    if (key !== useTokenStore.getState().sessionId) {\n      result[key] = msg[key];\n    }\n  }\n\n  let arr = Object.entries(result);\n  let streamUsers = arr.map((v: any) => {\n    return {\n      userId: v[1].userId,\n      fileName: v[1].fileName,\n      userName: v[1].userName,\n    };\n  });\n\n  useStreamingUsers.getState().setStreamUsers(streamUsers);\n};\n","import { toast, TypeOptions } from \"react-toastify\";\n\nexport const ShowToast = (m: string, t: TypeOptions, progress?: boolean) =>\n  toast(m, {\n    type: t,\n    position: \"bottom-right\",\n    autoClose: 2000,\n    hideProgressBar: progress ? false : true,\n    closeOnClick: true,\n    draggable: false,\n  });\n","const baseUrl =\r\n  process.env.NODE_ENV === \"production\"\r\n    ? `${window.location.host}`\r\n    : `${window.location.hostname}:4000`;\r\n\r\nexport const apiBaseUrl = `${\r\n  window.location.protocol === \"https:\" ? \"https\" : \"http\"\r\n}://${baseUrl}/api`;\r\n\r\nexport const wsBaseUrl = `${\r\n  window.location.protocol === \"https:\" ? \"wss\" : \"ws\"\r\n}://${baseUrl}/socket`;\r\n","import { detectDevice, Device } from \"mediasoup-client\";\nimport { ShowToast } from \"../components/ShowToast\";\nimport {\n  ConnectionState,\n  useMediaSoupConnectionState,\n  useMediaStore,\n  useTokenStore,\n  useUserInfoStore,\n} from \"../stores\";\nimport { wsend } from \"./createWebSocket\";\nimport { Oper } from \"./types\";\n\nconst queue = new Map<string, (json: any) => Promise<void>>();\n\nexport const defaultConstraints = {\n  audio: true,\n  video: true,\n  // video: { width: 640, height: 480 },\n  // video: {\n  //   width: {\n  //     min: 640,\n  //     ideal: 1920,\n  //     max: 2560,\n  //   },\n  //   height: {\n  //     min: 480,\n  //     ideal: 1080,\n  //     max: 1440,\n  //   },\n  //   facingMode: useMediaStore.getState().facingMode,\n  // },\n};\n\n// const mediaCodecs = [\n//   {\n//     kind: \"audio\" as MediaKind,\n//     mimeType: \"audio/opus\",\n//     clockRate: 48000,\n//     channels: 2,\n//   },\n//   {\n//     kind: \"video\" as MediaKind,\n//     mimeType: \"video/VP8\",\n//     clockRate: 90000,\n//     parameters: {\n//       \"x-google-start-bitrate\": 1000,\n//     },\n//   },\n//   {\n//     kind: \"video\" as MediaKind,\n//     mimeType: \"video/VP9\",\n//     clockRate: 90000,\n//     parameters: {\n//       \"profile-id\": 2,\n//       \"x-google-start-bitrate\": 1000,\n//     },\n//   },\n//   {\n//     kind: \"video\" as MediaKind,\n//     mimeType: \"video/H264\",\n//     clockRate: 90000,\n//     parameters: {\n//       \"packetization-mode\": 1,\n//       \"profile-level-id\": \"4d0032\",\n//       \"level-asymmetry-allowed\": 1,\n//       \"x-google-start-bitrate\": 1000,\n//     },\n//   },\n// ];\n\nconst hasGetUserMedia = () => {\n  return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);\n};\n\nexport const getUserMedia = async () => {\n  if (hasGetUserMedia()) {\n    return await navigator.mediaDevices.getUserMedia(defaultConstraints);\n  } else {\n    ShowToast(\"Browser not supported.\", \"error\");\n    throw new Error(\"Browser not supported\");\n  }\n};\n\n// const getVideoCodecs = () => {\n//   // eslint-disable-next-line no-restricted-globals\n//   let params = new URLSearchParams(location.search.slice(1));\n//   let videoCodec = params.get(\"videocodec\");\n\n//   const codec = mediaCodecs.find((c) => {\n//     if (!videoCodec) return undefined;\n//     return ~c.mimeType.toLowerCase().indexOf(videoCodec.toLowerCase());\n//   });\n\n//   return codec !== undefined\n//     ? codec\n//     : {\n//         kind: \"video\" as MediaKind,\n//         mimeType: \"video/H264\",\n//         clockRate: 90000,\n//         parameters: {\n//           \"packetization-mode\": 1,\n//           \"profile-level-id\": \"4d0032\",\n//           \"level-asymmetry-allowed\": 1,\n//           \"x-google-start-bitrate\": 1000,\n//         },\n//       };\n// };\n\nexport const handleRouterRtpCapabilitiesRequest = async (msg: any) => {\n  const { routerRtpCapabilities } = msg;\n  try {\n    console.log(detectDevice());\n    const device = new Device();\n    await device.load({ routerRtpCapabilities });\n    useMediaStore.getState().set({ device });\n\n    if (!device.loaded) {\n      throw new Error(\"Peer or device is not initialized\");\n    }\n\n    wsend({\n      op: Oper.create_transport,\n      d: {\n        sessionId: useTokenStore.getState().sessionId,\n        userId: useUserInfoStore.getState().user.id,\n      },\n    });\n  } catch (error) {\n    console.error(\n      \"handleRouterRtpCapabilities() failed to init device [error:%o]\",\n      error\n    );\n    ShowToast(\"Error in WebRTC....\", \"error\");\n  }\n};\n\nexport const handleCreateTransportRequest = async (msg: any) => {\n  const { id, dtlsParameters, iceCandidates, iceParameters } = msg;\n  try {\n    const sendTransport = await useMediaStore\n      .getState()\n      .device!.createSendTransport({\n        id,\n        dtlsParameters,\n        iceCandidates,\n        iceParameters,\n      });\n\n    useMediaStore.getState().set({\n      sendTransport,\n    });\n\n    handleSendTransportListeners();\n    getMediaStream();\n  } catch (error) {\n    console.error(\n      \"handleCreateTransportRequest() failed to create transport [error:%o]\",\n      error\n    );\n    ShowToast(\"Error in WebRTC....\", \"error\");\n  }\n};\n\nexport const handleConnectTransportRequest = async (msg: any) => {\n  console.log(\"handleTransportConnectRequest()\");\n  try {\n    const action = queue.get(\"connect_transport\");\n    if (!action) {\n      throw new Error(\"transport-connect action was not found\");\n    }\n    await action(msg);\n  } catch (error) {\n    console.error(\"handleTransportConnectRequest() failed [error:%o]\", error);\n  }\n};\n\nexport const handleProduceRequest = async (msg: any) => {\n  console.log(\"handleProduceRequest()\");\n  try {\n    const action = queue.get(\"produce\");\n    if (!action) {\n      throw new Error(\"produce action was not found\");\n    }\n    await action(msg);\n  } catch (error) {\n    console.error(\"handleProduceRequest() failed [error:%o]\", error);\n  }\n};\n\nconst handleSendTransportListeners = () => {\n  const sendTransport = useMediaStore.getState().sendTransport;\n\n  sendTransport!.on(\n    \"connect\",\n    async ({ dtlsParameters }, callback, errback) => {\n      console.log(\"handleTransportConnectEvent()\");\n      try {\n        const action = async (json: any) => {\n          console.log(\"connect_transport action\");\n          callback();\n          queue.delete(\"connect_transport\");\n        };\n\n        queue.set(\"connect_transport\", action);\n\n        wsend({\n          op: Oper.connect_transport,\n          d: {\n            sessionId: useTokenStore.getState().sessionId,\n            transportId: useMediaStore.getState().sendTransport!.id,\n            dtlsParameters,\n          },\n        });\n      } catch (error) {\n        console.error(\"handleTransportConnectEvent() failed [error:%o]\", error);\n        errback(error);\n      }\n    }\n  );\n\n  sendTransport!.on(\n    \"produce\",\n    async ({ kind, rtpParameters }, callback, errback) => {\n      console.log(\"handleTransportProduceEvent()\");\n      try {\n        const action = async (json: any) => {\n          console.log(\"handleTransportProduceEvent callback [data:%o]\", json);\n          callback({ id: json.id });\n          queue.delete(\"produce\");\n        };\n\n        queue.set(\"produce\", action);\n\n        wsend({\n          op: Oper.produce,\n          d: {\n            sessionId: useTokenStore.getState().sessionId,\n            transportId: useMediaStore.getState().sendTransport!.id,\n            kind,\n            rtpParameters,\n          },\n        });\n      } catch (error) {\n        console.error(\"handleTransportProduceEvent() failed [error:%o]\", error);\n        errback(error);\n      }\n    }\n  );\n\n  sendTransport!.on(\n    \"connectionstatechange\",\n    (connectionState: ConnectionState) => {\n      console.log(\n        \"send transport connection state change [state:%s]\",\n        connectionState\n      );\n      useMediaSoupConnectionState.getState().setStatus(connectionState);\n\n      switch (connectionState) {\n        case \"connected\":\n          ShowToast(\"WebRTC is connected\", \"info\");\n          break;\n        case \"connecting\":\n          ShowToast(\"WebRTC is connecting...\", \"warning\");\n          break;\n        case \"disconnected\":\n          ShowToast(\"WebRTC is disconnected\", \"error\");\n          break;\n        case \"failed\":\n          ShowToast(\"WebRTC is connection failed\", \"error\");\n          break;\n        default:\n          break;\n      }\n    }\n  );\n};\n\nexport const handleCloseWebRTCConnection = (msg: any) => {\n  console.log(\"closing webrtc...\");\n  useMediaStore\n    .getState()\n    .mediaStream?.getTracks()\n    .forEach((t) => t.stop());\n  useMediaStore.getState().sendTransport?.close();\n  useMediaStore.getState().producers.forEach((p) => p.close());\n  useMediaStore.getState().nullify();\n};\n\nconst getMediaStream = async () => {\n  try {\n    const mediaStream = await getUserMedia();\n    useMediaStore.getState().set({ mediaStream });\n\n    const device = useMediaStore.getState().device;\n\n    const videoTrack = mediaStream.getVideoTracks()[0];\n    const audioTrack = mediaStream.getAudioTracks()[0];\n\n    const sendTransport = useMediaStore.getState().sendTransport;\n    const producers = useMediaStore.getState().producers;\n\n    if (videoTrack) {\n      const videoProducer = await sendTransport!.produce({\n        track: videoTrack,\n        codec: device!.rtpCapabilities.codecs!.find(\n          (codec) => codec.mimeType.toLowerCase() === \"video/vp8\"\n        ),\n      });\n      producers.push(videoProducer);\n    }\n    if (audioTrack) {\n      const audioProducer = await sendTransport!.produce({\n        track: audioTrack,\n      });\n      producers.push(audioProducer);\n    }\n  } catch (err) {\n    ShowToast(err.toString(), \"error\");\n    console.log(err);\n  }\n};\n","import { Button } from \"@material-ui/core\";\nimport React from \"react\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { useMediaStore, useTokenStore, useUserInfoStore } from \"../stores\";\nimport { closeWebSocket, wsend } from \"../utils/createWebSocket\";\nimport { Oper } from \"../utils/types\";\n\ninterface Props {}\n\nconst Headers: React.FC<Props> = () => {\n  const user = useUserInfoStore((s) => s.user);\n  const history = useHistory();\n  const location = useLocation();\n\n  return (\n    <div className=\"flex flex-row flex-wrap items-center justify-between gap-4\">\n      <div className=\"flex flex-row flex-wrap items-center gap-4\">\n        <div className=\"text-l font-semibold\">\n          {user.first_name} {user.last_name} ({user.email})\n        </div>\n        {location.pathname === \"/stream\" ? (\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => {\n              history.push(\"/\");\n              wsend({\n                op: Oper.close_webrtc,\n                d: {\n                  sessionId: useTokenStore.getState().sessionId,\n                  userId: useUserInfoStore.getState().user.id,\n                  fileName: useMediaStore.getState().fileName,\n                },\n              });\n            }}\n          >\n            Back\n          </Button>\n        ) : location.pathname === \"/\" ? (\n          <>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={() => history.push(\"/stream\")}\n            >\n              Go Live!\n            </Button>\n          </>\n        ) : (\n          <>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={() => history.push(\"/\")}\n            >\n              Home\n            </Button>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={() => history.push(\"/stream\")}\n            >\n              Go Live!\n            </Button>\n          </>\n        )}\n      </div>\n      <Button\n        variant=\"contained\"\n        color=\"secondary\"\n        onClick={() => {\n          useTokenStore.getState().clearTokens();\n          closeWebSocket();\n          history.push(\"/\");\n        }}\n      >\n        Logout\n      </Button>\n    </div>\n  );\n};\n\nexport default Headers;\n","import React from \"react\";\nimport { useTokenStore } from \"../stores\";\nimport Headers from \"./Headers\";\n\ninterface Props {}\n\nconst Layout: React.FC<Props> = ({ children }) => {\n  const hasToken = useTokenStore((s) => !!s.accessToken);\n\n  if (hasToken) {\n    return (\n      <div className=\"mx-6 my-14 bg-white rounded p-6\">\n        <Headers />\n        <div className=\"mt-6\">{children}</div>\n      </div>\n    );\n  }\n\n  return <div>{children}</div>;\n};\n\nexport default Layout;\n","import React, { useEffect } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { useStreamingUsers } from \"../stores\";\nimport { wsend } from \"../utils/createWebSocket\";\nimport { Oper } from \"../utils/types\";\n\ninterface Props {}\n\nconst Home: React.FC<Props> = () => {\n  const streamUsers = useStreamingUsers((s) => s.streamUsers);\n\n  useEffect(() => {\n    wsend({\n      op: Oper.get_streaming_sessions,\n      d: {},\n    });\n  }, []);\n\n  return (\n    <div>\n      {streamUsers.length > 0 ? (\n        <>\n          <b>Streaming Users [Total users: {streamUsers.length}]</b>\n          <br />\n          <br />\n          {streamUsers.map((s, i) => (\n            <div key={s.fileName} className=\"flex gap-4\">\n              <div>\n                {i + 1}: <b>{s.userName}</b> is streaming.{\" \"}\n                <Link to={`/live/${s.fileName}`} className=\"underline\">\n                  To Watch Click Here\n                </Link>\n              </div>\n            </div>\n          ))}\n        </>\n      ) : (\n        <b>No User is streaming...</b>\n      )}\n    </div>\n  );\n};\n\nexport default Home;\n","import React, { useEffect, useMemo, useRef } from \"react\";\nimport { useWindowSize } from \"react-use\";\nimport videojs from \"video.js\";\n// Styles\nimport \"video.js/dist/video-js.css\";\n\ninterface IVideoPlayerProps {\n  options?: videojs.PlayerOptions;\n  fileName: string;\n}\n\nconst VideoPlayer: React.FC<IVideoPlayerProps> = ({ options, fileName }) => {\n  const { width, height } = useWindowSize();\n  const videoNode = useRef<any>();\n  const player = useRef<videojs.Player>();\n\n  const initialOptions: videojs.PlayerOptions = useMemo(() => {\n    return {\n      controls: true,\n      preload: \"true\",\n      //   fuild: true,\n      responsive: true,\n      width: width - 120,\n      height: height - 250,\n      //   aspectRatio: \"4:3\",\n      controlBar: {\n        volumePanel: {\n          inline: false,\n        },\n      },\n    };\n  }, [height, width]);\n\n  useEffect(() => {\n    player.current = videojs(videoNode.current, {\n      ...initialOptions,\n      ...options,\n    }).ready(function () {\n      console.log(\"onPlayerReady\");\n    });\n\n    return () => {\n      if (player.current) {\n        player.current.dispose();\n      }\n    };\n  }, [initialOptions, options]);\n\n  return (\n    <div className=\"flex items-center\">\n      <video ref={videoNode} className=\"video-js vjs-default-skin\">\n        <source\n          src={`http://localhost/live/${fileName}/index.m3u8`}\n          type=\"application/x-mpegURL\"\n        />\n      </video>\n    </div>\n  );\n};\n\nexport default VideoPlayer;\n","import React, { useEffect } from \"react\";\nimport { useHistory, useParams } from \"react-router\";\nimport VideoPlayer from \"../components/VideoPlayer\";\n\ninterface Props {}\n\nconst Live: React.FC<Props> = () => {\n  const { id } = useParams<any>();\n  const history = useHistory();\n\n  useEffect(() => {\n    if (!id) {\n      history.push(\"/\");\n    }\n  }, [history, id]);\n\n  return (\n    <div>\n      <b>Live</b>\n      <br />\n      <div className=\"flex w-full justify-center items-start\">\n        <VideoPlayer fileName={id} />\n      </div>\n    </div>\n  );\n};\n\nexport default Live;\n","import { withStyles } from \"@material-ui/core/styles\";\nimport Button from \"@material-ui/core/Button\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Select from \"@material-ui/core/Select\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\nimport InputLabel from \"@material-ui/core/InputLabel\";\nimport Input from \"@material-ui/core/Input\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Chip from \"@material-ui/core/Chip\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport DialogContentText from \"@material-ui/core/DialogContentText\";\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\nimport Checkbox from \"@material-ui/core/Checkbox\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\nimport Table from \"@material-ui/core/Table\";\nimport TableBody from \"@material-ui/core/TableBody\";\nimport TableCell from \"@material-ui/core/TableCell\";\nimport TableContainer from \"@material-ui/core/TableContainer\";\nimport TableHead from \"@material-ui/core/TableHead\";\nimport TableRow from \"@material-ui/core/TableRow\";\nimport TableSortLabel from \"@material-ui/core/TableSortLabel\";\n\nexport const CusButton = withStyles({})(Button);\n\nexport const CusPaper = withStyles({})(Paper);\n\nexport const CusTextField = withStyles({\n  root: {\n    width: \"100%\",\n  },\n})(TextField);\n\nexport const CusSelect = withStyles({})(Select);\n\nexport const CusFormControl = withStyles({\n  root: {\n    width: \"100%\",\n  },\n})(FormControl);\n\nexport const CusFormHelperText = withStyles({})(FormHelperText);\n\nexport const CusInputLabel = withStyles({})(InputLabel);\n\nexport const CusInput = withStyles({})(Input);\n\nexport const CusMenu = withStyles({})(Menu);\n\nexport const CusMenuItem = withStyles({})(MenuItem);\n\nexport const CusDialog = withStyles({})(Dialog);\n\nexport const CusDialogActions = withStyles({})(DialogActions);\n\nexport const CusDialogContent = withStyles({})(DialogContent);\n\nexport const CusDialogContentText = withStyles({})(DialogContentText);\n\nexport const CusDialogTitle = withStyles({})(DialogTitle);\n\nexport const CusChip = withStyles({})(Chip);\n\nexport const CusCheckbox = withStyles({})(Checkbox);\n\nexport const CusFormControlLabel = withStyles({})(FormControlLabel);\n\nexport const CusTableContainer = withStyles({})(TableContainer);\n\nexport const CusTable = withStyles({})(Table);\n\nexport const CusTableBody = withStyles({})(TableBody);\n\nexport const CusTableHead = withStyles({})(TableHead);\n\nexport const CusTableRow = withStyles({})(TableRow);\n\nexport const CusTableCell = withStyles({})(TableCell);\n\nexport const CusTableSortLabel = withStyles({})(TableSortLabel);\n","import { SetStateAction, useState } from \"react\";\r\nimport * as yup from \"yup\";\r\n\r\nexport type FormErrors<T> = {\r\n  [K in keyof T]: string | \"\";\r\n};\r\n\r\ntype useFormType<T> = {\r\n  initValues: T;\r\n  initErrors: FormErrors<T>;\r\n  validateSchema: any;\r\n  setValues: (value: SetStateAction<T>) => void;\r\n  values: T;\r\n};\r\n\r\nexport function useForm<T>({\r\n  initErrors,\r\n  initValues,\r\n  values,\r\n  setValues,\r\n  validateSchema,\r\n}: useFormType<T>) {\r\n  const [formErrors, setFormErrors] = useState<FormErrors<T>>(initErrors);\r\n\r\n  const handleChange = (event: any) => {\r\n    const name = event.target.name;\r\n\r\n    const value =\r\n      event.target.type === \"checkbox\"\r\n        ? event.target.checked\r\n        : event.target.value;\r\n    setValues({\r\n      ...values,\r\n      [name]: value,\r\n    });\r\n    setFormErrors(initErrors);\r\n  };\r\n\r\n  const changeMaskInput = (value: any, fieldName: string) => {\r\n    setValues({\r\n      ...values,\r\n      [fieldName]: value,\r\n    });\r\n  };\r\n\r\n  const changeSwitch = (value: any, fieldName: string) => {\r\n    setValues({\r\n      ...values,\r\n      [fieldName]: value,\r\n    });\r\n  };\r\n\r\n  const selectChange = (value: any, fieldName: string) => {\r\n    setValues({\r\n      ...values,\r\n      [fieldName]: value,\r\n    });\r\n  };\r\n\r\n  const cascaderSelect = (value: string[], fieldName: string[]) => {\r\n    const fieldValues = fieldName.reduce((acc: any, cur: any, index: any) => {\r\n      return { ...acc, [cur]: value[index] };\r\n    }, {});\r\n\r\n    setValues({\r\n      ...values,\r\n      ...fieldValues,\r\n    });\r\n  };\r\n\r\n  const numberChange = (value: any, fieldName: string) => {\r\n    setValues({\r\n      ...values,\r\n      [fieldName]: isNaN(value) ? 0 : value,\r\n    });\r\n  };\r\n\r\n  const handleBlur = (event: any) => {\r\n    const name = event.target.name;\r\n    const value = event.target.value;\r\n    yup\r\n      .reach(validateSchema, name, \"\", \"\")\r\n      .validate(value)\r\n      .catch((err: any) => {\r\n        setFormErrors({\r\n          ...formErrors,\r\n          [name]: err.message,\r\n        });\r\n      });\r\n  };\r\n\r\n  const formValidation = async (): Promise<boolean> => {\r\n    try {\r\n      await yup\r\n        .reach(validateSchema, \"\", \"\", \"\")\r\n        .validate(values, { abortEarly: false });\r\n      setFormErrors({ ...initErrors });\r\n      return true;\r\n    } catch (err) {\r\n      let errors = err.inner.reduce((acc: any, current: any) => {\r\n        if (acc[current.path]) return { ...acc };\r\n        return { ...acc, [current.path]: current.message };\r\n      }, {});\r\n      setFormErrors({ ...formErrors, ...errors });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const handleReset = () => setValues(initValues);\r\n\r\n  return {\r\n    handleChange,\r\n    handleBlur,\r\n    handleReset,\r\n    formValidation,\r\n    formErrors,\r\n    selectChange,\r\n    numberChange,\r\n    cascaderSelect,\r\n    changeMaskInput,\r\n    changeSwitch,\r\n  };\r\n}\r\n","import axios, { AxiosRequestConfig } from \"axios\";\r\nimport { useTokenStore } from \"../stores\";\r\nimport { apiBaseUrl } from \"./apiQueries\";\r\n\r\nexport function axiosClient() {\r\n  const defaultOptions: AxiosRequestConfig = {\r\n    baseURL: apiBaseUrl,\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n  };\r\n\r\n  // Create instance\r\n  let instance = axios.create(defaultOptions);\r\n\r\n  // Set the AUTH token for any request\r\n  instance.interceptors.request.use(function (config) {\r\n    const token = localStorage.getItem(\"token\");\r\n    config.headers.Authorization = token;\r\n    return config;\r\n  });\r\n\r\n  instance.defaults.headers.common[\r\n    \"Authorization\"\r\n  ] = useTokenStore.getState().accessToken;\r\n\r\n  return instance;\r\n}\r\n","import { FormErrors } from \"../hooks/useForm\";\nimport { LoginFormInput, RegisterFormInput } from \"./types\";\n\nexport const LoginFormInitValues: LoginFormInput = {\n  email: \"\",\n  password: \"\",\n};\n\nexport const LoginFormInitErrors: FormErrors<LoginFormInput> = {\n  email: \"\",\n  password: \"\",\n};\n\nexport const RegisterFormInitValues: RegisterFormInput = {\n  confirm_password: \"\",\n  first_name: \"\",\n  last_name: \"\",\n  password: \"\",\n  email: \"\",\n};\n\nexport const RegisterFormInitErrors: FormErrors<RegisterFormInput> = {\n  confirm_password: \"\",\n  first_name: \"\",\n  last_name: \"\",\n  password: \"\",\n  email: \"\",\n};\n","import * as yup from \"yup\";\n\nexport const LoginFormValidation = yup.object({\n  email: yup.string().required(\"Required\").email(\"Wrong email address\"),\n  password: yup.string().required(\"Required\"),\n});\n\nexport const RegisterFormValidation = yup.object({\n  first_name: yup.string().required(\"Required\"),\n  last_name: yup.string().required(\"Required\"),\n  email: yup.string().required(\"Required\").email(\"Wrong email address\"),\n  password: yup.string().required(\"Required\").min(6, \"Min 6 charaters\"),\n  confirm_password: yup.string().required(\"Required\").min(6, \"Min 6 charaters\"),\n});\n","import React, { useState } from \"react\";\nimport { useMutation } from \"react-query\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport { CusButton, CusTextField } from \"../components/StyledComponents\";\nimport { useForm } from \"../hooks/useForm\";\nimport { useTokenStore, useUserInfoStore } from \"../stores\";\nimport { axiosClient } from \"../utils/axiosClient\";\nimport { LoginFormInitErrors, LoginFormInitValues } from \"../utils/formInits\";\nimport { LoginFormInput } from \"../utils/types\";\nimport { LoginFormValidation } from \"../utils/validations\";\n\ninterface Props {}\n\nconst Login: React.FC<Props> = () => {\n  const { setTokens } = useTokenStore();\n  const { setUser } = useUserInfoStore();\n\n  const history = useHistory();\n\n  const mutation = useMutation(\n    (input: LoginFormInput) => axiosClient().post(\"/login\", input),\n    {\n      onSuccess: (res) => {\n        setTokens({\n          accessToken: res.data.accessToken,\n          expiresIn: res.data.expiresIn,\n        });\n        setUser(res.data.user);\n        history.replace(\"/\");\n      },\n    }\n  );\n\n  const [formValues, setFormValues] = useState<LoginFormInput>(\n    LoginFormInitValues\n  );\n\n  const form = useForm({\n    initErrors: LoginFormInitErrors,\n    initValues: LoginFormInitValues,\n    setValues: setFormValues,\n    validateSchema: LoginFormValidation,\n    values: formValues,\n  });\n\n  const handleSubmit = async () => {\n    const valid = await form.formValidation();\n    if (!valid) return;\n    mutation.mutate(formValues);\n  };\n\n  return (\n    <div className=\"flex items-center min-h-screen\">\n      <div className=\"max-w-md m-auto bg-white p-6 shadow-md rounded\">\n        <div className=\"text-xl font-bold\">Login</div>\n        <form>\n          <CusTextField\n            id=\"email\"\n            label={\"Email\"}\n            name=\"email\"\n            variant=\"standard\"\n            margin={\"dense\"}\n            value={formValues.email}\n            onChange={form.handleChange}\n            onBlur={form.handleBlur}\n            helperText={\n              form.formErrors.email !== \"\" ? form.formErrors.email : \" \"\n            }\n            error={form.formErrors.email !== \"\"}\n          />\n          <CusTextField\n            id=\"password\"\n            name=\"password\"\n            label={\"Password\"}\n            variant=\"standard\"\n            margin={\"dense\"}\n            type={\"password\"}\n            value={formValues.password}\n            onChange={form.handleChange}\n            onBlur={form.handleBlur}\n            helperText={\n              form.formErrors.password !== \"\" ? form.formErrors.password : \" \"\n            }\n            error={form.formErrors.password !== \"\"}\n          />\n          <br />\n          <br />\n          <div className=\"flex flex-row flex-wrap items-center justify-between gap-4\">\n            <div>\n              <CusButton\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={handleSubmit}\n                disabled={mutation.isLoading}\n              >\n                Login\n              </CusButton>\n            </div>\n            <div>\n              or <Link to=\"/register\">Register a new Account</Link>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default Login;\n","import React, { useState } from \"react\";\nimport { useMutation } from \"react-query\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport { CusButton, CusTextField } from \"../components/StyledComponents\";\nimport { useForm } from \"../hooks/useForm\";\nimport { useTokenStore, useUserInfoStore } from \"../stores\";\nimport { axiosClient } from \"../utils/axiosClient\";\nimport {\n  RegisterFormInitErrors,\n  RegisterFormInitValues,\n} from \"../utils/formInits\";\nimport { RegisterFormInput } from \"../utils/types\";\nimport { RegisterFormValidation } from \"../utils/validations\";\n\ninterface Props {}\n\nconst Register: React.FC<Props> = () => {\n  const { setTokens } = useTokenStore();\n  const { setUser } = useUserInfoStore();\n  const history = useHistory();\n\n  const mutation = useMutation(\n    (input: RegisterFormInput) => axiosClient().post(\"/register\", input),\n    {\n      onSuccess: (res) => {\n        setTokens({\n          accessToken: res.data.accessToken,\n          expiresIn: res.data.expiresIn,\n        });\n        setUser(res.data.user);\n        history.replace(\"/\");\n      },\n    }\n  );\n\n  const [formValues, setFormValues] = useState<RegisterFormInput>(\n    RegisterFormInitValues\n  );\n\n  const form = useForm({\n    initErrors: RegisterFormInitErrors,\n    initValues: RegisterFormInitValues,\n    setValues: setFormValues,\n    validateSchema: RegisterFormValidation,\n    values: formValues,\n  });\n\n  const handleSubmit = async () => {\n    const valid = await form.formValidation();\n    if (!valid) return;\n    mutation.mutate(formValues);\n  };\n\n  return (\n    <div className=\"flex items-center min-h-screen\">\n      <div className=\"max-w-md m-auto bg-white p-6 shadow-md rounded\">\n        <div className=\"text-xl font-bold\">Register</div>\n        <form>\n          <CusTextField\n            id=\"first_name\"\n            label={\"First name\"}\n            name=\"first_name\"\n            variant=\"standard\"\n            margin={\"dense\"}\n            value={formValues.first_name}\n            onChange={form.handleChange}\n            onBlur={form.handleBlur}\n            helperText={\n              form.formErrors.first_name !== \"\"\n                ? form.formErrors.first_name\n                : \" \"\n            }\n            error={form.formErrors.first_name !== \"\"}\n          />\n\n          <CusTextField\n            id=\"last_name\"\n            label={\"First name\"}\n            name=\"last_name\"\n            variant=\"standard\"\n            margin={\"dense\"}\n            value={formValues.last_name}\n            onChange={form.handleChange}\n            onBlur={form.handleBlur}\n            helperText={\n              form.formErrors.last_name !== \"\" ? form.formErrors.last_name : \" \"\n            }\n            error={form.formErrors.last_name !== \"\"}\n          />\n          <CusTextField\n            id=\"email\"\n            label={\"Email\"}\n            name=\"email\"\n            variant=\"standard\"\n            margin={\"dense\"}\n            value={formValues.email}\n            onChange={form.handleChange}\n            onBlur={form.handleBlur}\n            helperText={\n              form.formErrors.email !== \"\" ? form.formErrors.email : \" \"\n            }\n            error={form.formErrors.email !== \"\"}\n          />\n          <CusTextField\n            id=\"password\"\n            name=\"password\"\n            label={\"Password\"}\n            variant=\"standard\"\n            margin={\"dense\"}\n            type={\"password\"}\n            value={formValues.password}\n            onChange={form.handleChange}\n            onBlur={form.handleBlur}\n            helperText={\n              form.formErrors.password !== \"\" ? form.formErrors.password : \" \"\n            }\n            error={form.formErrors.password !== \"\"}\n          />\n          <CusTextField\n            id=\"confirm_password\"\n            name=\"confirm_password\"\n            label={\"Confirm password\"}\n            variant=\"standard\"\n            margin={\"dense\"}\n            type={\"password\"}\n            value={formValues.confirm_password}\n            onChange={form.handleChange}\n            onBlur={form.handleBlur}\n            helperText={\n              form.formErrors.confirm_password !== \"\"\n                ? form.formErrors.confirm_password\n                : \" \"\n            }\n            error={form.formErrors.confirm_password !== \"\"}\n          />\n          <br />\n          <br />\n          <div className=\"flex flex-row flex-wrap items-center justify-between gap-4\">\n            <div>\n              <CusButton\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={handleSubmit}\n                disabled={mutation.isLoading}\n              >\n                Register\n              </CusButton>\n            </div>\n            <div>\n              or <Link to=\"/\">Already registered.</Link>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default Register;\n","import { Button } from \"@material-ui/core\";\nimport React, { useEffect, useLayoutEffect, useRef, useState } from \"react\";\nimport { useWindowSize } from \"react-use\";\nimport { useMediaStore, useTokenStore, useUserInfoStore } from \"../stores\";\nimport { wsend } from \"../utils/createWebSocket\";\nimport { Oper } from \"../utils/types\";\n\ninterface Props {}\n\nconst Stream: React.FC<Props> = () => {\n  const { height } = useWindowSize();\n  const sessionId = useTokenStore((s) => s.sessionId);\n  const ref = useRef<HTMLVideoElement>(null);\n  const mediaStream = useMediaStore((s) => s.mediaStream);\n\n  const [start, setStart] = useState<boolean>(false);\n  const [stop, setStop] = useState<boolean>(false);\n\n  useLayoutEffect(() => {\n    wsend({\n      op: Oper.router_rtp_capabilities,\n      d: {\n        sessionId,\n      },\n    });\n  }, [sessionId]);\n\n  useEffect(() => {\n    if (mediaStream) {\n      if (ref.current) {\n        ref.current.srcObject = mediaStream;\n        setStart(true);\n      }\n    }\n  }, [mediaStream]);\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-center flex-row flex-wrap\">\n        <Button\n          disabled={!start}\n          onClick={() => {\n            wsend({\n              op: Oper.start_stream,\n              d: {\n                sessionId: useTokenStore.getState().sessionId,\n                userId: useUserInfoStore.getState().user.id,\n                userName: `${useUserInfoStore.getState().user.first_name} ${\n                  useUserInfoStore.getState().user.last_name\n                }`,\n              },\n            });\n            setStart(false);\n            setStop(true);\n          }}\n        >\n          Start Streaming\n        </Button>\n        <Button\n          disabled={!stop}\n          onClick={() => {\n            wsend({\n              op: Oper.stop_stream,\n              d: {\n                sessionId: useTokenStore.getState().sessionId,\n                userId: useUserInfoStore.getState().user.id,\n                fileName: useMediaStore.getState().fileName,\n              },\n            });\n            setStart(true);\n            setStop(false);\n          }}\n        >\n          Stop Streaming\n        </Button>\n      </div>\n      <div className=\"flex w-full justify-center items-start\">\n        <video\n          ref={ref}\n          autoPlay\n          playsInline\n          muted\n          controls\n          style={{\n            maxWidth: \"1000px\",\n            maxHeight: \"700px\",\n            width: `100%`,\n            height: `${height - 250}px`,\n          }}\n        ></video>\n      </div>\n    </div>\n  );\n};\n\nexport default Stream;\n","import React, { useEffect, useLayoutEffect } from \"react\";\nimport { useQuery } from \"react-query\";\nimport { Redirect, Route, Switch } from \"react-router-dom\";\nimport Layout from \"./components/Layout\";\nimport Home from \"./containers/Home\";\nimport Live from \"./containers/Live\";\nimport Login from \"./containers/Login\";\nimport Register from \"./containers/Register\";\nimport Stream from \"./containers/Stream\";\nimport { useTokenStore, useUserInfoStore } from \"./stores\";\nimport { axiosClient } from \"./utils/axiosClient\";\nimport { closeWebSocket, createWebSocket } from \"./utils/createWebSocket\";\n\ninterface Props {}\n\nconst App: React.FC<Props> = () => {\n  const hasToken = useTokenStore((s) => !!s.accessToken);\n\n  const { isError } = useQuery(\n    \"user-info\",\n    () => axiosClient().get(\"/userInfo\"),\n    {\n      onSuccess: (res) => useUserInfoStore.getState().setUser(res.data.user),\n      enabled: hasToken,\n    }\n  );\n\n  useLayoutEffect(() => {\n    if (hasToken) {\n      createWebSocket();\n    }\n  }, [hasToken]);\n\n  useEffect(() => {\n    if (isError) {\n      useTokenStore.getState().clearTokens();\n      closeWebSocket();\n    }\n  }, [isError]);\n\n  let routes = (\n    <Switch>\n      <Route path=\"/\" exact component={Login} />\n      <Route path=\"/register\" exact component={Register} />\n      <Redirect to=\"/\" />\n    </Switch>\n  );\n\n  if (hasToken) {\n    routes = (\n      <Switch>\n        <Route path=\"/\" exact component={Home} />\n        <Route path=\"/stream\" exact component={Stream} />\n        <Route path=\"/live/:id\" exact component={Live} />\n      </Switch>\n    );\n  }\n\n  return <Layout>{routes}</Layout>;\n};\n\nexport default App;\n","import { QueryClient } from \"react-query\";\nimport { ShowToast } from \"../components/ShowToast\";\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    mutations: {\n      onError: (e: any) => {\n        if (e.response) {\n          if (e.response.data.message) {\n            ShowToast(e.response.data.message, \"error\");\n          }\n        }\n      },\n    },\n    queries: {\n      retry: false,\n      staleTime: 60 * 1000 * 5,\n      onError: (e: any) => {\n        if (e.response) {\n          if (e.response.data.message) {\n            ShowToast(e.response.data.message, \"error\");\n          }\n        }\n      },\n    },\n  },\n});\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { QueryClientProvider } from \"react-query\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport { ToastContainer } from \"react-toastify\";\nimport \"react-toastify/dist/ReactToastify.min.css\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport \"video.js/dist/video-js.css\";\nimport { queryClient } from \"./utils/queryClient\";\n\nconst app = (\n  <QueryClientProvider client={queryClient}>\n    <BrowserRouter>\n      <App />\n    </BrowserRouter>\n    <ToastContainer />\n  </QueryClientProvider>\n);\n\nReactDOM.render(app, document.getElementById(\"root\"));\n"],"sourceRoot":""}